!function(){"use strict";var a=angular.module("piwik-external-dashboard.users",[]);a.run(["$rootScope","UserFetchers",function(a,b){a.$on("users.fetcher",function(a,c,d){"string"==typeof c&&"undefined"!=typeof d&&b.add(c,d)})}])}(),function(){"use strict";var a=function(){this.login=null,this.alias=null,this.email=null,this.superuser=!1};a.prototype.me=function(){var b=this;return"anonymous"===this.login?void(this.alias="anonymous"):void a.fetcher.getUser(this.login).then(function(a){1===a.data.length&&(b.alias=a.data[0].alias,b.email=a.data[0].email,b.superuser="1"===a.data[0].superuser_access)})},a.prototype.isValid=function(){return null!==this.login||null!==this.alias||null!==this.email},angular.module("piwik-external-dashboard.users").factory("User",["UserFetchers",function(b){return a.fetcher=b.get(),a}])}(),function(){"use strict";var a=angular.module("piwik-external-dashboard.users");a.provider("UserFetchers",["USERS_SOURCE",function(a){var b;this.$get=["Fetchers",function(c){return b||(b=new c(a)),b}]}])}(),function(a){"use strict";var b=a.module("piwik-external-dashboard.auth",["piwik-external-dashboard.application"]);b.run(["Token","Authenticate",function(b,c){b.restore(),c.isAuthenticated()&&(a.isDefined(c.me)&&c.me.isValid()||c.getUserInformation(b.login))}]),b.config(["$httpProvider",function(a){a.interceptors.push("TokenInterceptor")}]),b.run(["$rootScope","Authenticate","$location",function(b,c,d){b.$on("$routeChangeStart",function(b,e){a.isDefined(e.auth)&&e.auth===!0&&!c.isAuthenticated()&&(d.path(c.getLoginPath()),b.preventDefault())})}]),b.run(["$rootScope","AuthFetchers",function(a,b){a.$on("auth.fetcher",function(a,c,d){"string"==typeof c&&"undefined"!=typeof d&&b.add(c,d)})}])}(angular),function(){"use strict";var a=function(a,b,c){this.me=new b,this.login=function(b,c,d){var e=a.get(b,c,d),f=this;return e.then(function(d){angular.isDefined(d.data.value)&&(a.tokenAuth=d.data.value,a.host=b,a.login=c,a.persist(),f.getUserInformation(c))}),e},this.asAnonymous=function(b){var d=c.defer();return d.resolve("anonymous"),a.tokenAuth="anonymous",a.host=b,a.login="anonymous",this.getUserInformation("anonymous"),a.persist(),d.promise},this.isAuthenticated=function(){return a.isValid()},this.getLoginPath=function(){return"/login"},this.getUserInformation=function(a){this.me.login=a,this.me.me()}};a.$inject=["Token","User","$q"],angular.module("piwik-external-dashboard.auth").service("Authenticate",a)}(),function(){"use strict";var a=function(a,b,c,d){this.login=null,this.tokenAuth=null,this.host=null,this.get=function(c,d,e){return a.get().getTokenAuth({host:c,userLogin:d,md5Password:b(e)})},this.isValid=function(){return null!==this.tokenAuth&&null!==this.host},this.persist=function(){c.put("token",{tokenAuth:this.tokenAuth,login:this.login,host:this.host})},this.restore=function(){var a;null!==d?(this.tokenAuth=d.tokenAuth,this.login=d.login,this.host=d.host):(a=c.get("token"),angular.isDefined(a)&&(this.tokenAuth=a.tokenAuth,this.login=a.login,this.host=a.host))}};a.$inject=["AuthFetchers","md5","$cookieStore","LOGGED_IN_USER"],angular.module("piwik-external-dashboard.auth").service("Token",a)}(),function(){"use strict";var a=angular.module("piwik-external-dashboard.auth");a.service("TokenInterceptor",["Token","$rootScope",function(a,b){return{request:function(c){return b.$emit("auth.token",c,a),c}}}])}(),function(a){"use strict";var b=function(b,c,d){var e=this;this.host="",this.login="",this.password="",this.anonymous=!1,this.loading=!1,this.noAccess=!1,this.process=function(){var a;a=this.anonymous?b.asAnonymous(this.host):b.login(this.host,this.login,this.password),this.loading=!0,a.then(function(){c.fetchAllWithAtLeastViewAccess().then(e.redirectIfThereIsAnySiteOrMarkAsNoAccess)}),a["finally"](function(){e.loading=!1})},this.redirectIfThereIsAnySiteOrMarkAsNoAccess=function(b){a.isArray(b.data)&&b.data.length>0?d.path("/"+b.data[0].idsite):e.noAccess=!0},this.isComplete=function(){return this.isValidHost()&&this.isValidUser()},this.isValidHost=function(){return null!==this.host&&this.host.length>0},this.isValidUser=function(){return this.anonymous===!0||this.isValidLogin()&&this.isValidPassword()},this.isValidLogin=function(){return null!==this.login&&this.login.length>0},this.isValidPassword=function(){return null!==this.password&&this.password.length>0}};b.$inject=["Authenticate","Site","$location"],a.module("piwik-external-dashboard.auth").controller("LoginCtrl",b).config(["$routeProvider","ASSETS_BASE_PATH",function(a,b){a.when("/login",{templateUrl:b+"views/login/index.html",controller:"LoginCtrl",controllerAs:"login"})}])}(angular),function(){"use strict";var a=angular.module("piwik-external-dashboard.auth");a.provider("AuthFetchers",["REPORTS_SOURCE",function(a){var b;this.$get=["Fetchers",function(c){return b=new c(a)}]}])}(),function(){"use strict";var a=angular.module("piwik-external-dashboard.api",[]);a.run(["$rootScope","ApiReportFetcher","UsersFetcher",function(a,b,c){a.$emit("reports.fetcher","api",b),a.$emit("application.fetcher","api",b),a.$emit("sites.fetcher","api",b),a.$emit("auth.fetcher","api",c),a.$emit("users.fetcher","api",c)}]),a.run(["$rootScope","ApiTokenInterceptor","AUTH_SOURCE",function(a,b,c){"api"===c.source&&a.$on("auth.token",function(a,c,d){b.isValid(c,d)&&b.intercept(c,d)})}])}(),function(){"use strict";angular.module("piwik-external-dashboard.api").service("ApiReportFetcher",["$http",function(a){this.fetch=function(b){return b.method="API.getProcessedReport",a.post("/api",b)},this.fetchMetaData=function(b){return b.method="API.getReportMetadata",b.date="today",b.period="day",a.post("/api",b)},this.getVersion=function(){return a.post("/api",{method:"API.getPiwikVersion"})},this.getLogo=function(){return a.post("/api",{method:"API.getLogoUrl"})},this.getSitesWithViewAccess=function(){return a.post("/api",{method:"SitesManager.getSitesWithAtLeastViewAccess"})}}])}(),function(){"use strict";angular.module("piwik-external-dashboard.api").service("UsersFetcher",["$http",function(a){this.getTokenAuth=function(b){return b.method="UsersManager.getTokenAuth",a.post("/api",b)},this.getUser=function(b){return a.post("/api",{method:"UsersManager.getUser",userLogin:b})}}])}(),function(){"use strict";angular.module("piwik-external-dashboard.api").service("ApiTokenInterceptor",function(){this.isValid=function(a,b){return"POST"===a.method&&0===a.url.indexOf("/api")&&b.isValid()},this.intercept=function(a,b){a.data.host=b.host,a.data.token_auth=b.tokenAuth}})}(),function(){"use strict";var a=angular.module("piwik-external-dashboard.piwik-api",[]);a.run(["$rootScope","PiwikApiReportFetcher",function(a,b){a.$emit("reports.fetcher","piwik-api",b),a.$emit("application.fetcher","piwik-api",b),a.$emit("sites.fetcher","piwik-api",b),a.$emit("auth.fetcher","piwik-api",b),a.$emit("users.fetcher","piwik-api",b)}]),a.run(["$rootScope","PiwikApiTokenInterceptor","AUTH_SOURCE",function(a,b,c){"piwik-api"===c.source&&a.$on("auth.token",function(a,c,d){b.isValid(c,d)&&b.intercept(c,d)})}])}(),function(){"use strict";angular.module("piwik-external-dashboard.piwik-api").service("PiwikApiReportFetcher",["$http",function(a){var b=function(b){var c=[];angular.isDefined(b.module)||(b.module="API"),angular.isDefined(b.format)||(b.format="json");for(var d in b)c.push(d+"="+b[d]);return a.get("/index.php?"+c.join("&"))};this.fetch=function(a){return a.method="API.getProcessedReport",b(a)},this.fetchMetaData=function(a){return a.method="API.getReportMetadata",a.date="today",a.period="day",b(a)},this.getVersion=function(){return b({method:"API.getPiwikVersion"})},this.getLogo=function(){return b({method:"API.getLogoUrl"})},this.getSitesWithViewAccess=function(){return b({method:"SitesManager.getSitesWithAtLeastViewAccess"})},this.getTokenAuth=function(a){return a.method="UsersManager.getTokenAuth",b(a)},this.getUser=function(a){return b({method:"UsersManager.getUser",userLogin:a})}}])}(),function(){"use strict";angular.module("piwik-external-dashboard.piwik-api").service("PiwikApiTokenInterceptor",function(){this.isValid=function(a){return 0===a.url.indexOf("/index.php")},this.intercept=function(a,b){a.url.indexOf("token_auth")<0&&(a.url+="&token_auth="+b.tokenAuth)}})}(),function(){"use strict";var a=angular.module("piwik-external-dashboard.application",[]);a.run(["$rootScope","ApplicationFetchers",function(a,b){a.$on("application.fetcher",function(a,c,d){"string"==typeof c&&"undefined"!=typeof d&&b.add(c,d)})}]),a.constant("PIWIK_CHANGELOG_URL","http://piwik.org/changelog/piwik")}(),function(a){"use strict";a.module("piwik-external-dashboard.application").directive("applicationSidebar",["ASSETS_BASE_PATH",function(a){return{templateUrl:a+"views/application/sidebar.html",link:function(a,b,c){a.menu={show:!1,sm:{toggle:!1},md:{toggle:!1}},a.$watch("menu.sm.toggle",function(b,c){b!==c&&(a.states.sm.toggle=b)}),a.$watch("menu.md.toggle",function(b,c){b!==c&&(a.states.md.toggle=b)}),a.active=c.active}}}])}(window.angular),function(){"use strict";var a=angular.module("piwik-external-dashboard.application");a.directive("applicationBrandLogo",["ApplicationFetchers","PIWIK_CHANGELOG_URL","ASSETS_BASE_PATH","LOGO_BACK_URL",function(a,b,c,d){return{replace:!0,templateUrl:c+"views/application/brand-logo.html",link:function(c){var e=a.get(),f={version:e.getVersion(),logo:e.getLogo()};c.backUrl=d,f.logo.then(function(a){angular.isDefined(a.data)&&angular.isDefined(a.data.value)&&(c.logoUrl=a.data.value)}),f.version.then(function(a){angular.isDefined(a.data)&&angular.isDefined(a.data.value)&&(c.version="v"+a.data.value,c.changeLogUrl=b+"-",c.changeLogUrl+=a.data.value.split(".").join("-")+"/")})}}}])}(),function(){"use strict";var a=angular.module("piwik-external-dashboard.application");a.directive("applicationBackdrop",["ApplicationWindow","$http",function(a,b){return{template:['<div class="overlay text-center" ng-show="numberOfActiveRequests > 0">','<i class="fa fa-spinner fa-spin fa-5x" ng-style="{\'marginTop\': dimensionsForIcon().height}"></i>',"<br />Waiting for {{ numberOfActiveRequests }} requests... ","</div>"].join(""),scope:!1,replace:!0,link:function(c,d){var e=d.find("i");c.getWindowDimensions=function(){return a.getDimensions()},c.$watch(c.getWindowDimensions,function(a){c.windowHeight=a.h,c.windowWidth=a.w,c.dimensionsForIcon=function(a){return a||(a=e),{height:(c.windowHeight-a.height())/2+"px",width:(c.windowWidth-a.width())/2+"px"}}},!0),a.onResize(function(){c.$apply()}),c.isLoading=function(){return b.pendingRequests.length>0},c.numberOfActiveRequests=b.pendingRequests.length,c.$watch(c.isLoading,function(){c.numberOfActiveRequests=b.pendingRequests.length})}}}])}(),function(a){"use strict";a.module("piwik-external-dashboard.application").directive("applicationUserBar",["$cookieStore","Authenticate","ASSETS_BASE_PATH",function(a,b,c){return{replace:!0,templateUrl:c+"views/application/user-bar.html",link:function(c){c.user=b.me,c.logout=function(){a.remove("token")}}}}])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.application").directive("applicationContainer",["ASSETS_BASE_PATH",function(a){return{templateUrl:a+"views/application/container.html",transclude:!0,replace:!0,link:function(a){a.states={sm:{toggled:!1},md:{toggled:!1}}}}}])}(window.angular),function(){"use strict";var a=function(a){this.source=a.source,this.fetchers={}},b=angular.module("piwik-external-dashboard.application");a.prototype.add=function(a,b){this.fetchers[a]=b},a.prototype.get=function(){return this.fetchers[this.source]?this.fetchers[this.source]:!1},b.factory("Fetchers",function(){return a})}(),function(){"use strict";var a=angular.module("piwik-external-dashboard.application");a.provider("ApplicationFetchers",["REPORTS_SOURCE",function(a){var b;this.$get=["Fetchers",function(c){return b||(b=new c(a)),b}]}])}(),function(){"use strict";var a=angular.module("piwik-external-dashboard.application");a.service("ApplicationWindow",["$window",function(a){var b=angular.element(a);this.getDimensions=function(){return{h:b.height(),w:b.width()}},this.onResize=function(a){b.bind("resize",a)}}])}(),function(){"use strict";angular.module("piwik-external-dashboard.dashboard",[],["$provide",function(a){a.constant("dashboardStateKey","dashboard")}])}(),function(a){"use strict";var b,c,d,e=function(a,e,f,g,h,i){var j=this;b=f,c=e,d=g,this.localState=i,this.dashboards=h,this.initialize(a),a.$on("$destroy",function(){j.dashboards.clear()})};e.prototype.initialize=function(e){var f=this;this.localState.load().then(function(a){f.dashboards.add(a),f.current=f.dashboards.getActive()},function(){var a=new d;f.current=a,f.current.active=!0,f.dashboards.add(a)}),this.sortableOptions={update:function(){b(function(){f.persist()})},cancel:".add"},e.$on("sites.selectedSite",function(b,d){a.isDefined(d.idsite)&&c.path("/"+d.idsite)})},e.prototype.persist=function(){this.localState.persist(this.dashboards.states)},e.prototype.add=function(){this.dashboards.add(new d)},e.prototype.change=function(a){this.current.active=!1,this.current=a,this.current.active=!0,this.persist()},e.prototype.remove=function(){if(this.canRemove()){var a=this;this.dashboards.remove(this.current).then(function(b){a.current=b,a.current.active=!0,a.persist()})}},e.prototype.canRemove=function(){return this.dashboards.getSize()>1},e.$inject=["$scope","$location","$timeout","DashboardState","DashboardStates","DashboardLocalState"],a.module("piwik-external-dashboard.dashboard").controller("DashboardCtrl",e).config(["$routeProvider","ASSETS_BASE_PATH",function(a,b){a.when("/:idSite?",{templateUrl:b+"views/dashboard/index.html",controller:"DashboardCtrl",controllerAs:"dashboard",auth:!0})}])}(window.angular),function(a){"use strict";var b=function(b,c,d,e){var f=this;this.period="day",this.ranges={"Last 7 days":[e().subtract("days",7),e()],"Last 30 days":[e().subtract("days",30),e()],"This month":[e().startOf("month"),e().endOf("month")]},a.isDefined(d.date)&&this.initializeDate(d.date,b,e),b.$watch("dates",function(a,b){a!==b&&("day"===f.period?c.search("date",a.startDate.format("YYYY-MM-DD")):c.search("date",[a.startDate.format("YYYY-MM-DD"),a.endDate.format("YYYY-MM-DD")].join(",")))})};b.prototype.initializeDate=function(a,b,c){-1!==a.indexOf(",")?(this.period="range",b.dates={startDate:c(a.split(",")[0]),endDate:c(a.split(",")[1])}):b.dates={startDate:c(a),endDate:c(a).add("days",1)}},b.$inject=["$scope","$location","$routeParams","moment"],a.module("piwik-external-dashboard.dashboard").controller("DashboardDateSelectorCtrl",b)}(window.angular),function(a){"use strict";var b=function(){this.create=function(){}};b.$inject=["$scope","$modal","ReportsStateFetcher","$location","Report"],a.module("piwik-external-dashboard.dashboard").controller("DashboardExportReportsCtrl",b)}(window.angular),function(a){"use strict";var b=function(b,c,d,e){this.openModal=function(){b.open({templateUrl:e+"views/reports/add-modal.html",controller:"AddReportModalCtrl",resolve:{reports:["Report",function(a){return a.fetchMetaData()}]}}).result.then(function(b){c.getActive().reports.push(a.copy(b)),d.persist(c.states)})}};b.$inject=["$modal","DashboardStates","DashboardLocalState","ASSETS_BASE_PATH"],a.module("piwik-external-dashboard.dashboard").controller("DashboardAddReportCtrl",b)}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.dashboard").directive("dashboardNavBar",["ASSETS_BASE_PATH",function(a){return{templateUrl:a+"views/dashboard/nav-bar.html"}}])}(angular),function(a){"use strict";a.module("piwik-external-dashboard.dashboard").directive("dashboardDateSelector",["ASSETS_BASE_PATH",function(a){return{templateUrl:a+"views/dashboard/nav/date-selector.html",controller:"DashboardDateSelectorCtrl",controllerAs:"dateSelector",replace:!0}}])}(angular),function(a){"use strict";a.module("piwik-external-dashboard.dashboard").directive("dashboardExportReports",["ASSETS_BASE_PATH",function(a){return{scope:!1,controller:"DashboardExportReportsCtrl",controllerAs:"export",templateUrl:a+"views/dashboard/nav/export-reports.html"}}])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.dashboard").directive("dashboardAddReport",["ASSETS_BASE_PATH",function(a){return{scope:!1,controller:"DashboardAddReportCtrl",controllerAs:"addReport",templateUrl:a+"views/dashboard/nav/add-report.html"}}])}(window.angular),function(a){"use strict";var b,c=function(b,c){this.name=a.isString(b)&&b.length>0?b:"Dashboard",this.reports=a.isArray(c)?c:[],this.active=!1};c.prototype.serialize=function(){return a.toJson(this)},c.prototype.unserialize=function(c){var d=a.fromJson(c);return this.name=d.name,this.reports=b.unserialize(d.reports),this.active=d.active===!0,this},c.prototype.remove=function(a){var b=this.reports.indexOf(a);b>-1&&this.reports.splice(b,1)},a.module("piwik-external-dashboard.dashboard").factory("DashboardState",["Report",function(a){return b=a,c}])}(window.angular),function(a){"use strict";var b=function(b){var c=this;c.states=[],c.getActive=function(){for(var a in c.states)if(c.states.hasOwnProperty(a)&&c.states[a].active)return c.states[a];return!1},c.add=function(b){a.isArray(b)?a.forEach(b,function(a){c.add(a)}):c.states.push(b)},c.getSize=function(){return c.states.length},c.remove=function(a){var d=c.states.indexOf(a),e=b.defer();if(d>-1){var f=d-1;0>f&&(f=0),c.states.splice(d,1),e.resolve(c.states[f])}else e.reject();return e.promise},c.clear=function(){c.states=[]}};b.$inject=["$q"],a.module("piwik-external-dashboard.dashboard").service("DashboardStates",b)}(window.angular),function(a,b){"use strict";var c=function(c,d,e,f){var g=this;g.synced={},g.getSync=function(d){return a.isDefined(g.synced[d])||(g.synced[d]=c(new b("https://piwik-ext-dashboard.firebaseio.com/"+d))),g.synced[d]},g.load=function(b,c){var d=f.defer();return a.isDefined(c)&&c.length>0?(a.isDefined(g.synced[b])||(g.synced[b]=g.getSync(b)),g.getSync(b).$asObject().$loaded().then(function(a){d.resolve(a[c])})):d.resolve(e.get("reports")),d.promise},g.save=function(a,b){var c=f.defer(),e=d(b);return e in g.getSync(a).$asObject()?c.resolve(e):g.getSync(a).$set(e,b).then(function(){c.resolve(e)}),c.promise},g.persist=function(a,b){e.isSupported?e.add(a,b):e.cookie.add(a,b)}};c.$inject=["$firebase","md5","localStorageService","$q"],a.module("piwik-external-dashboard.dashboard").service("ReportsStateFetcher",c)}(window.angular,window.Firebase),function(a){"use strict";var b=function(b,c,d,e){var f=this;f.load=function(){var a=e.defer(),f=c.get(b);if(null===f)a.reject();else{for(var g=0;g<f.length;++g){var h=new d;f[g]=h.unserialize(f[g])}a.resolve(f)}return a.promise},f.persist=function(d){var e=[];a.forEach(d,function(a){e.push(a.serialize())}),e=a.toJson(e),c.isSupported?c.add(b,e):c.cookie.add(b,e)}};b.$inject=["dashboardStateKey","localStorageService","DashboardState","$q"],a.module("piwik-external-dashboard.dashboard").service("DashboardLocalState",b)}(angular),function(){"use strict";angular.module("piwik-external-dashboard.widget",[],["$provide",function(a){a.value("chartsColors",[{fillColor:"rgba(17,63,140,0.2)",strokeColor:"rgba(17,63,140,1)",pointColor:"rgba(17,63,140,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(17,63,140,1)",color:"#113F8C",highlight:"#113F8C"},{fillColor:"rgba(1,164,164,0.2)",strokeColor:"rgba(1,164,164,1)",pointColor:"rgba(1,164,164,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(1,164,164,1)",color:"#01A4A4",highlight:"#01A4A4"},{fillColor:"rgba(0,161,203,0.2)",strokeColor:"rgba(0,161,203,1)",pointColor:"rgba(0,161,203,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(0,161,203,1)",color:"#00A1CB",highlight:"#00A1CB"},{fillColor:"rgba(97,174,36,0.2)",strokeColor:"rgba(97,174,36,1)",pointColor:"rgba(97,174,36,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(97,174,36,1)",color:"#61AE24",highlight:"#61AE24"},{fillColor:"rgba(208,209,2,0.2)",strokeColor:"rgba(208,209,2,1)",pointColor:"rgba(208,209,2,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(208,209,2,1)",color:"#D0D102",highlight:"#D0D102"},{fillColor:"rgba(50,116,44,0.2)",strokeColor:"rgba(50,116,44,1)",pointColor:"rgba(50,116,44,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(50,116,44,1)",color:"#32742C",highlight:"#32742C"},{fillColor:"rgba(215,0,96,0.2)",strokeColor:"rgba(215,0,96,1)",pointColor:"rgba(215,0,96,1)",pointStrokeColor:"#fff",pointHighlightFill:"#fff",pointHighlightStroke:"rgba(215,0,96,1)",color:"#D70060",highlight:"#D70060"}])}])}(),function(a){"use strict";a.module("piwik-external-dashboard.widget").filter("isEmpty",function(){return function(b){if(a.isArray(b))return!b||!b.length;if(a.isObject(b)){var c;for(c in b)if(b.hasOwnProperty(c))return!1;return!0}return!!b}})}(angular),function(a){"use strict";a.module("piwik-external-dashboard.widget").directive("singleWidget",["ASSETS_BASE_PATH",function(b){return{restrict:"AC",transclude:!0,scope:{report:"=",dashboard:"="},templateUrl:b+"views/widget/single.html",controller:["$scope","$routeParams",function(b,c){this.report=b.report.report,b.hasIdSite=a.isDefined(c.idSite)}]}}])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.widget").directive("singleWidgetHeader",["ASSETS_BASE_PATH",function(b){return{restrict:"AC",scope:{report:"=",dashboard:"="},replace:!0,templateUrl:b+"views/widget/single/header.html",controller:["$scope","$timeout",function(b,c){var d=this,e=null,f=null;this.report=b.report,this.dashboard=b.dashboard,b.size=null,b.$watch("size",function(b,g){b!==g&&(null!==e&&c.cancel(e),e=c(function(){var e=d.report.visualization;null!==f&&(c.cancel(f),a.isDefined(d.report._visualization)&&(d.report.visualization=d.report._visualization)),d.report._visualization=e,d.report.size=b,d.report.visualization=null,f=c(function(){d.report.visualization=e,d.dashboard.persist()},200)},200))})}],controllerAs:"config"}}])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.widget").directive("singleWidgetFooter",["ASSETS_BASE_PATH",function(a){return{restrict:"AC",scope:{report:"=",dashboard:"="},replace:!0,templateUrl:a+"views/widget/single/footer.html",controller:["$scope",function(a){a.sizes=[];for(var b=1;13>b;++b)a.sizes.push(b);a.visualizations=["evolution","table","bar","pie"]}]}}])}(window.angular),function(){"use strict";var a=angular.module("piwik-external-dashboard.reports",["piwik-external-dashboard.application"]);a.run(["$rootScope","ReportFetchers",function(a,b){a.$on("reports.fetcher",function(a,c,d){"string"==typeof c&&"undefined"!=typeof d&&b.add(c,d)})}])}(),function(a){"use strict";var b,c=function(a,c,d,e){b=a,this.initializeSizes(),this.initializeVisualizations(),this.initializeReports(d,e),b.add=function(){c.close({size:b.size,visualization:b.visualization,report:b.report})},b.cancel=function(){c.dismiss("cancel")}};c.prototype.initializeSizes=function(){b.size=null,b.sizes=[];for(var a=1;13>a;++a)b.sizes.push(a);b.changeSize=function(a){b.sizes.indexOf(a)>-1&&(b.size=a)}},c.prototype.initializeVisualizations=function(){b.visualization=null,b.visualizationTypes=["table","evolution","bar","pie"],b.changeVisualization=function(a){b.visualizationTypes.indexOf(a)>-1&&(b.visualization=a)}},c.prototype.initializeReports=function(c,d){b.report=null,b.reports=d.groupMetaDataByColumn(c.data,"category"),b.changeReport=function(c){a.isDefined(b.reports[c.category])&&a.forEach(b.reports[c.category],function(a){c===a&&(b.report=d.createFromMetaData(a))})}},a.module("piwik-external-dashboard.reports").controller("AddReportModalCtrl",["$scope","$modalInstance","reports","Report",c])}(window.angular),function(){"use strict";var a=function(a,b,c,d){this.module=a,this.action=b,this.evolution=c,this.name=d,this.loading=!1,this.limit=!1,this.metadata={},this.data=!1};a.prototype.fetch=function(){var b=this,c=a.fetcher.fetch(this.getParameters());return this.loading=!0,c.then(function(a){return b.loading=!1,b.metadata=a.data.metadata,b.data=a.data.reportData,a}),c},a.prototype.getParameters=function(){var b={apiModule:this.module,apiAction:this.action,idSite:a.$routeParams.idSite,period:this.getPeriod(),date:this.getDate()};return this.limit!==!1&&(b.filter_limit=this.limit),b},a.prototype.getDate=function(){var b=a.moment().format("YYYY-MM-DD");return angular.isDefined(a.$routeParams.date)&&(b=a.$routeParams.date),this.evolution&&-1===b.indexOf(",")&&(b=[a.moment(b).subtract("days",this.getNumberOfDaysForEvolution()-1).format("YYYY-MM-DD"),a.moment(b).format("YYYY-MM-DD")].join(",")),b},a.prototype.getPeriod=function(){return!angular.isDefined(a.$routeParams.date)||this.evolution?"day":-1===a.$routeParams.date.indexOf(",")?"day":"range"},a.prototype.getNumberOfDaysForEvolution=function(){return 10},a.createFromMetaData=function(b){return new a(b.module,b.action,null,b.name)},a.fetchMetaData=function(){return a.fetcher.fetchMetaData({idSite:a.$routeParams.idSite})},a.groupMetaDataByColumn=function(a,b){var c={};return angular.forEach(a,function(a){c[a[b]]||(c[a[b]]=[]),c[a[b]].push(a)}),c},a.serialize=function(a){var b=[];return angular.forEach(a,function(a){b.push({report:{module:a.report.module,action:a.report.action,name:a.report.name},visualization:a.visualization,size:a.size})}),angular.toJson(b)},a.unserialize=function(b){return angular.forEach(b,function(b){b.report=new a(b.report.module,b.report.action,"evolution"===b.visualization,b.report.name)}),b},angular.module("piwik-external-dashboard.reports").factory("Report",["$routeParams","moment","$q","ReportFetchers",function(b,c,d,e){return a.$routeParams=b,a.moment=c,a.$q=d,a.fetcher=e.get(),a}])}(),function(){"use strict";var a=angular.module("piwik-external-dashboard.reports");a.provider("ReportFetchers",["REPORTS_SOURCE",function(a){var b;this.$get=["Fetchers",function(c){return b||(b=new c(a)),b}]}])}(),function(){"use strict";var a=angular.module("piwik-external-dashboard.sites",[]);a.run(["$rootScope","SitesFetchers",function(a,b){a.$on("sites.fetcher",function(a,c,d){"string"==typeof c&&"undefined"!=typeof d&&b.add(c,d)})}])}(),function(a){"use strict";var b=function(a,b,c){a.sites=[],a.site={},this.initialize(a,b,c),a.$watch("site",function(b){a.$emit("sites.selectedSite",b)})};b.prototype.initialize=function(b,c,d){c.fetchAllWithAtLeastViewAccess().then(function(c){b.sites=c.data,a.isDefined(d.idSite)?a.forEach(b.sites,function(a){a.idsite===d.idSite&&(b.site=a)}):b.site=c.data[0]})},a.module("piwik-external-dashboard.sites").controller("SitesSelectorCtrl",["$scope","Site","$routeParams",b])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.sites").directive("sitesSelector",["ASSETS_BASE_PATH",function(a){return{controller:"SitesSelectorCtrl",templateUrl:a+"views/sites/selector.html",replace:!0}}])}(angular),function(){"use strict";var a=angular.module("piwik-external-dashboard.sites");a.provider("SitesFetchers",["SITES_SOURCE",function(a){var b;this.$get=["Fetchers",function(c){return b||(b=new c(a)),b}]}])}(),function(){"use strict";var a=function(a){this.fetchAllWithAtLeastViewAccess=function(){return a.get().getSitesWithViewAccess()}};a.$inject=["SitesFetchers"],angular.module("piwik-external-dashboard.sites").service("Site",a)}(),function(a){"use strict";a.module("piwik-external-dashboard.morris",[])}(angular),function(a){"use strict";var b=function(b,c,d,e){var f=this;b.data=[],b.xkey="label",b.ykeys=[],b.labels=[],b.metricsColors=d,b.metrics=[],b.dateFormat=function(a){return c(a).format("YYYY-MM-DD")},b.toggleMetric=function(c,d){if(a.isDefined(f.graph)&&!(c.enabled&&e.getEnabled(b.metrics).length<2)){if(c.enabled=!c.enabled,c.enabled)b.labels.splice(d,0,c.name),b.ykeys.splice(d,0,c.key);else{var g=b.ykeys.indexOf(c.key);b.labels.splice(g,1),b.ykeys.splice(g,1)}e.rebuild(b.metrics),f.graph.setData(b.data,!0)}},b.setGraphInstance=function(a){f.graph=a}};a.module("piwik-external-dashboard.morris").controller("MorrisVisualizationCtrl",["$scope","moment","metricsColors","MetricsService",b])}(window.angular),function(a){"use strict";var b=function(b,c,d,e){var f=this;b.data=[],b.pieData=[],b.colors=d,b.metrics=[],b.toggleMetric=function(c){a.isDefined(f.graph)&&(c.enabled||(a.forEach(b.metrics,function(a){a.enabled=!1}),c.enabled=!0,b.buildDataForKey(c.key),e.rebuild(b.metrics),f.graph.setData(b.pieData,!0)))},b.setGraphInstance=function(a){f.graph=a},b.buildDataForKey=function(c){b.pieData=[],a.forEach(b.data,function(d){a.isDefined(d[c])&&b.pieData.push({label:d.label,value:d[c]})})}};a.module("piwik-external-dashboard.morris").controller("MorrisPieVisualizationCtrl",["$scope","moment","metricsColors","MetricsService",b])}(window.angular),function(a){"use strict";var b=function(a,b){this.metricsColors=a,this.Metric=b};b.prototype.getEnabled=function(a){return a.filter(function(a){return a.enabled})},b.prototype.rebuild=function(b){var c=this.getEnabled(b),d=this;a.forEach(c,function(a,b){a.color=d.metricsColors[b%d.metricsColors.length]})},b.prototype.parseMetadata=function(b,c,d,e){var f=this;a.forEach(b.metrics,function(a,g){c.push(g),d.push(a),e.push(new f.Metric(a,g,angular.isDefined(b.metricsDocumentation)&&angular.isDefined(b.metricsDocumentation[g])?b.metricsDocumentation[g]:""))})},b.prototype.confirmNumericValues=function(b,c,d,e,f){a.forEach(b,function(b,g){if(!a.isNumber(b)&&g!==f){var h=c.indexOf(g);h>-1&&(c.splice(h,1),d.splice(h,1),e.splice(h,1))}})},b.prototype.removeNonNumericValues=function(b,c){a.forEach(b,function(a,d){isNaN(a)&&d!==c&&angular.isObject(b)&&delete b[d]})},b.prototype.parseValues=function(b,c,d,e,f,g){var h=!1,i=[],j=this;return a.forEach(b,function(b,k){a.isArray(b)&&0===b.length?a.forEach(e,function(a){b[a.key]=0}):(h||(j.confirmNumericValues(b,c,d,e,f),h=!0),j.removeNonNumericValues(b,f)),a.isFunction(g)&&g(b,k),i.push(b)}),i},a.module("piwik-external-dashboard.morris").service("MetricsService",["metricsColors","Metric",b])}(window.angular),function(a){"use strict";var b=function(a,b,c){this.enabled=!0,this.description=c,this.name=a,this.key=b};a.module("piwik-external-dashboard.morris").factory("Metric",[function(){return b}])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.morris").directive("morrisMetricsSelector",["ASSETS_BASE_PATH",function(a){return{templateUrl:a+"views/morris/metricsSelector.html"}}])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.morris").directive("morrisEvolutionVisualization",["MetricsService","Metric","ASSETS_BASE_PATH",function(b,c,d){return{require:"^singleWidget",restrict:"AE",templateUrl:d+"views/morris/evolution/index.html",controller:"MorrisVisualizationCtrl",link:function(d,e,f,g){g.report.evolution=!0,g.report.fetch().then(function(e){if(a.isDefined(e.data.metadata)&&a.isDefined(e.data.metadata.metrics)){if(b.parseMetadata(e.data.metadata,d.ykeys,d.labels,d.metrics),a.isDefined(e.data.reportData)){var f=null;for(var g in e.data.reportData)if(e.data.reportData.hasOwnProperty(g)){if(f=e.data.reportData[g],a.isArray(f)&&0===f.length)continue;break}if(null!==f)if(a.isObject(f)&&!a.isArray(f))d.data=b.parseValues(e.data.reportData,d.ykeys,d.labels,d.metrics,d.xkey,function(a,b){a[d.xkey]=new Date(b).getTime()});else{var h,i=!0,j=d.metrics[0].key,k=0,l=[];for(var m in e.data.reportData)if(e.data.reportData.hasOwnProperty(m)){var n=e.data.reportData[m],o={};if(0===n.length){l.push(m);continue}if(i)for(k=Math.min(10,n.length),i=!1,d.ykeys=[],d.metrics=[],d.labels=[],h=0;k>h;++h)d.ykeys.push("metric"+h),d.labels.push(n[h].label),d.metrics.push(new c(n[h].label,"metric"+h,""));for(h=0;k>h;++h)o["metric"+h]=n[h][j];o[d.xkey]=new Date(m).getTime(),d.data.push(o)}a.forEach(l,function(a){var b={};for(h=0;k>h;++h)b["metric"+h]=0;b[d.xkey]=new Date(a).getTime(),d.data.push(b)})}}b.rebuild(d.metrics)}})}}}])}(window.angular),function(a){"use strict";
a.module("piwik-external-dashboard.morris").directive("morrisBarVisualization",["MetricsService","ASSETS_BASE_PATH",function(b,c){return{require:"^singleWidget",restrict:"AE",templateUrl:c+"views/morris/bar/index.html",controller:"MorrisVisualizationCtrl",link:function(c,d,e,f){f.report.evolution=!1,f.report.limit=20,f.report.fetch().then(function(d){a.isDefined(d.data.metadata)&&a.isDefined(d.data.metadata.metrics)&&(b.parseMetadata(d.data.metadata,c.ykeys,c.labels,c.metrics),a.isDefined(d.data.reportData)&&(c.data=b.parseValues(d.data.reportData,c.ykeys,c.labels,c.metrics,c.xkey)),b.rebuild(c.metrics))})}}}])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.morris").directive("morrisPieVisualization",["MetricsService","ASSETS_BASE_PATH",function(b,c){return{require:"^singleWidget",restrict:"AE",templateUrl:c+"views/morris/pie/index.html",controller:"MorrisPieVisualizationCtrl",link:function(c,d,e,f){f.report.evolution=!1,f.report.limit=20,f.report.fetch().then(function(d){a.isDefined(d.data.metadata)&&a.isDefined(d.data.metadata.metrics)&&(b.parseMetadata(d.data.metadata,[],[],c.metrics),a.forEach(c.metrics,function(a){a.enabled=!1}),c.metrics[0].enabled=!0,a.isDefined(d.data.reportData)&&(c.data=b.parseValues(d.data.reportData,[],[],c.metrics,"label"),c.buildDataForKey(c.metrics[0].key)),b.rebuild(c.metrics))})}}}])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.tables",[])}(angular),function(a){"use strict";var b=function(b,c){b.dimensions={page:1,perPage:10,total:100,sortBy:"nb_visits",sortOrder:"desc"},b.getFrom=function(){return(b.dimensions.page-1)*b.dimensions.perPage},b.getTo=function(){return b.dimensions.page*b.dimensions.perPage},b.changePage=function(a,c){a.preventDefault(),b.dimensions.page=c.number},b.sortBy=function(a){b.dimensions.sortBy===a?b.dimensions.sortOrder="asc"===b.dimensions.sortOrder?"desc":"asc":(b.dimensions.sortOrder="desc",b.dimensions.sortBy=a)},b.$watch("dimensions.page",function(){b.pages=c.generatePagesArray(b.dimensions)}),b.$watch("dimensions.perPage",function(){b.pages=c.generatePagesArray(b.dimensions)}),b.$watch("dimensions.total",function(){b.pages=c.generatePagesArray(b.dimensions)}),b.$watch("data",function(){a.isDefined(b.data)&&(b.dimensions.total=b.data.reportData.length)})};a.module("piwik-external-dashboard.tables").controller("TableVisualizationCtrl",["$scope","TablePaginationService",b])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.tables").directive("tableVisualization",["ASSETS_BASE_PATH",function(b){return{require:"^singleWidget",restrict:"AE",templateUrl:b+"views/tables/visualization.html",controller:"TableVisualizationCtrl",controllerAs:"visualization",replace:!0,link:function(b,c,d,e){e.report.limit=-1,e.report.evolution=!1,e.report.fetch().then(function(c){if(a.isDefined(c.data.metadata)){var d=a.extend(c.data.metadata.metrics,c.data.metadata.processedMetrics);if(b.data=c.data,b.columns=[],a.isArray(c.data.reportData))a.forEach(d,function(a,c){b.columns.push({key:c,label:a})});else{b.columns=[{key:"value",label:"Value"}];var e=a.copy(c.data.reportData);b.data.reportData=[],a.forEach(e,function(a,c){b.data.reportData.push({label:d[c],value:a})})}b.dimensions={page:1,perPage:10,total:100,sortBy:b.columns[0].key,sortOrder:"desc"}}})}}}])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.tables").directive("tablePagination",["ASSETS_BASE_PATH",function(a){return{templateUrl:a+"views/tables/pagination.html"}}])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.tables").filter("limitFromTo",function(){return function(a,b,c){if(!(a instanceof Array||a instanceof String))return a;if(c=parseInt(c,10),a instanceof String)return c?c>=0?a.slice(b,c):a.slice(c,a.length):"";var d,e,f=[];for(c>a.length?c=a.length:c<-a.length&&(c=-a.length),c>0?(d=b,e=c):(d=a.length+c,e=a.length);e>d;d++)f.push(a[d]);return f}})}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.tables").filter("min",function(){return function(b,c){return a.isNumber(b)?Math.min(b,c):b}})}(window.angular),function(a){"use strict";var b=function(){};b.prototype.generatePagesArray=function(a){var b,c,d,e,f,g,h=a.page,i=a.total,j=a.perPage;if(b=11,g=[],f=Math.ceil(i/j),f>1){g.push({type:"prev",number:Math.max(1,h-1),active:h>1}),g.push({type:"first",number:1,active:h>1}),d=Math.round((b-5)/2),e=Math.max(2,h-d),c=Math.min(f-1,h+2*d-(h-e)),e=Math.max(2,e-(2*d-(c-e)));for(var k=e;c>=k;)g.push(k===e&&2!==k||k===c&&k!==f-1?{type:"more",active:!1}:{type:"page",number:k,active:h!==k}),k++;g.push({type:"last",number:f,active:h!==f}),g.push({type:"next",number:Math.min(f,h+1),active:f>h})}return g},a.module("piwik-external-dashboard.tables").service("TablePaginationService",[b])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.whiteLabel",[],["$provide",function(a){a.value("metricsColors",["#0b62a4","#7A92A3","#4da74d","#afd8f8","#edc240","#cb4b4b","#9440ed"])}])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard.firebase",[]).run(["$rootScope",function(b){b.$on("checkPersistenceLayer",function(b,c,d){"firebase"===c&&a.isObject(d)&&a.isDefined(d.host)&&(b.confirmed=!0,b.stopPropagation())})}])}(window.angular),function(a){"use strict";a.module("piwik-external-dashboard",["ngCookies","ngSanitize","ngRoute","ui.bootstrap","angularMoment","ui.select2","firebase","LocalStorageModule","ngBootstrap","angular-morrisjs","ui.sortable","ui.gravatar","angular-md5","angular-growl","piwik-external-dashboard.application","piwik-external-dashboard.users","piwik-external-dashboard.widget","piwik-external-dashboard.reports","piwik-external-dashboard.sites","piwik-external-dashboard.morris","piwik-external-dashboard.tables","piwik-external-dashboard.whiteLabel","piwik-external-dashboard.firebase","piwik-external-dashboard.api","piwik-external-dashboard.piwik-api","piwik-external-dashboard.auth","piwik-external-dashboard.dashboard"]).config(["$locationProvider","$routeProvider","USE_HTML5_MODE",function(a,b,c){a.html5Mode(c===!0),b.otherwise("/")}])}(window.angular);